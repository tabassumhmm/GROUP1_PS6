<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stock Manager UI (Prototype)</title>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#98a0b3;--accent:#4f46e5;--danger:#ef4444}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:linear-gradient(180deg,#071028 0%,#071822 100%);color:#e6eef8}
    .container{max-width:1200px;margin:28px auto;padding:18px}
    nav{display:flex;gap:12px;align-items:center}
    .brand{font-weight:700;font-size:20px;color:var(--accent)}
    .nav {display:flex;gap:8px;margin-left:24px}
    .nav button{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer}
    .nav button.active{background:linear-gradient(90deg,rgba(79,70,229,0.12),rgba(79,70,229,0.04));color:#fff;border-color:rgba(79,70,229,0.3)}
    .right{margin-left:auto;display:flex;gap:8px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);}
    header .summary{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
    .summary .tile{padding:12px}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .controls input[type="search"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .controls button{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:14px}
    th{color:var(--muted);font-size:13px}
    .btn{padding:6px 8px;border-radius:6px;border:none;cursor:pointer}
    .btn.edit{background:#0ea5a4;color:#032020}
    .btn.delete{background:var(--danger);color:white}
    .btn.small{padding:4px 6px;font-size:13px}
    .status{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03)}
    .flex{display:flex;gap:12px;align-items:center}
    .muted{color:var(--muted)}
    .grid-2{display:grid;grid-template-columns:1fr 360px;gap:12px}
    .requests-list li{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
    .fraud{color:var(--danger);font-weight:600}
    footer{margin-top:24px;color:var(--muted);font-size:13px;text-align:center}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center}
    .modal{width:640px;background:var(--card);border-radius:12px;padding:18px}
    .row{display:flex;gap:8px}
    @media(max-width:900px){.grid-2{grid-template-columns:1fr}nav{flex-wrap:wrap}}
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <div class="brand">StockManager</div>
      <div class="nav" role="navigation">
        <button id="nav-home" class="active">Home</button>
        <button id="nav-transactions">Stock Transactions</button>
        <button id="nav-stocks">Stocks</button>
      </div>
      <div class="right">
        <div class="muted">admin@company.com</div>
        <button id="logout" class="btn">Logout</button>
      </div>
    </nav>

    <!-- HOME -->
    <section id="view-home" class="view" style="margin-top:18px">
      <div class="card">
        <div class="flex" style="justify-content:space-between;align-items:center">
          <h2>Dashboard</h2>
          <div class="muted">Welcome, Stock Manager</div>
        </div>
        <div class="summary">
          <div class="card tile">
            <div class="muted">Total Market Value</div>
            <div style="font-size:20px;font-weight:700">$1,245,900</div>
          </div>
          <div class="card tile">
            <div class="muted">Pending Requests</div>
            <div style="font-size:20px;font-weight:700" id="pending-count">3</div>
          </div>
          <div class="card tile">
            <div class="muted">Fraud Alerts (unresolved)</div>
            <div style="font-size:20px;font-weight:700;color:var(--danger)" id="fraud-count">1</div>
          </div>
        </div>

        <div style="margin-top:18px" class="grid-2">
          <div class="card">
            <h3>Transactions (last 30 days)</h3>
            <canvas id="txChart" height="160"></canvas>
          </div>
          <div class="card">
            <h3>Top Stocks</h3>
            <canvas id="stocksChart" height="160"></canvas>
            <div style="margin-top:12px">
              <strong>Recent Fraud Alerts</strong>
              <ul id="fraud-list" class="requests-list" style="margin-top:8px;padding-left:0;list-style:none"></ul>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- TRANSACTIONS -->
    <section id="view-transactions" class="view" style="display:none;margin-top:18px">
      <div class="card">
        <div class="controls">
          <input id="tx-search" type="search" placeholder="Search transactions (company, investor, type...)" />
          <button id="btn-add-tx">Add Transaction</button>
          <button id="btn-refresh-tx" class="btn small">Refresh</button>
        </div>
        <div style="overflow:auto">
          <table id="tx-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Timestamp</th>
                <th>Type</th>
                <th>Company</th>
                <th>Investor</th>
                <th>Shares</th>
                <th>Price</th>
                <th>Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3>Investor Sell Requests</h3>
        <ul id="sell-requests" class="requests-list" style="list-style:none;padding-left:0;margin-top:8px"></ul>
      </div>

    </section>

    <!-- STOCKS -->
    <section id="view-stocks" class="view" style="display:none;margin-top:18px">
      <div class="card">
        <div class="controls">
          <input id="stock-search" type="search" placeholder="Search stocks (stock id, company id...)" />
          <button id="btn-add-stock">Add Stock</button>
        </div>
        <div style="overflow:auto">
          <table id="stock-table">
            <thead>
              <tr>
                <th>Stock ID</th>
                <th>Company ID</th>
                <th>Total Shares</th>
                <th>Current Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3>Fraud Alerts</h3>
        <ul id="fraud-alerts" style="list-style:none;padding-left:0;margin-top:8px"></ul>
      </div>
    </section>

    <footer class="muted">Prototype UI — client-side only. Copy file and open in your browser to run.</footer>
  </div>

  <!-- Modals -->
  <div id="modal-back" class="modal-backdrop">
    <div class="modal card" role="dialog" aria-modal="true">
      <div id="modal-content"></div>
      <div style="text-align:right;margin-top:12px">
        <button id="modal-cancel" class="btn">Cancel</button>
        <button id="modal-save" class="btn" style="background:var(--accent);color:white">Save</button>
      </div>
    </div>
  </div>

<script>
// ----- Sample data -----
let transactions = [
  {id:1,ts:'2025-11-10 09:22',type:'Buy',company:'Acme Corp',investor:'InvestorA',shares:100,price:12.5},
  {id:2,ts:'2025-11-09 10:10',type:'Sell',company:'Beta Ltd',investor:'InvestorB',shares:50,price:8.2},
  {id:3,ts:'2025-11-01 11:45',type:'Buy',company:'Acme Corp',investor:'InvestorC',shares:200,price:13.0},
];
let stocks = [
  {stockId:'STK-001',companyId:'ACME',shares:10000,price:12.5},
  {stockId:'STK-002',companyId:'BETA',shares:15000,price:8.2},
  {stockId:'STK-003',companyId:'GAMMA',shares:8000,price:21.3},
];
let sellRequests = [
  {id:101,investor:'InvestorB',stock:'STK-002',shares:50,reason:'Need liquidity'},
  {id:102,investor:'InvestorD',stock:'STK-001',shares:200,reason:'Portfolio rebalancing'},
  {id:103,investor:'InvestorE',stock:'STK-003',shares:10,reason:'Small sell'},
];
let fraudAlerts = [
  {id:1,title:'Unusual large sell order',desc:'5000 shares sell request for STK-002 by unknown account',time:'2025-11-12 15:03'}
];

// ----- Utilities -----
const $ = id => document.getElementById(id);
function formatCurrency(n){return '$'+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}

// ----- Rendering -----
function renderTxTable(filter=''){
  const tbody = document.querySelector('#tx-table tbody');
  tbody.innerHTML='';
  const rows = transactions.filter(t=>{
    const s = JSON.stringify(t).toLowerCase();
    return s.includes(filter.toLowerCase());
  });
  rows.forEach(tx=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${tx.id}</td>
      <td>${tx.ts}</td>
      <td>${tx.type}</td>
      <td>${tx.company}</td>
      <td>${tx.investor}</td>
      <td>${tx.shares}</td>
      <td>${formatCurrency(tx.price)}</td>
      <td>${formatCurrency(tx.price*tx.shares)}</td>
      <td>
        <button class="btn edit small" data-id="${tx.id}">Edit</button>
        <button class="btn delete small" data-id="${tx.id}">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
function renderStockTable(filter=''){
  const tbody = document.querySelector('#stock-table tbody');
  tbody.innerHTML='';
  const rows = stocks.filter(s=>JSON.stringify(s).toLowerCase().includes(filter.toLowerCase()));
  rows.forEach(st=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${st.stockId}</td>
      <td>${st.companyId}</td>
      <td>${st.shares}</td>
      <td>${formatCurrency(st.price)}</td>
      <td>
        <button class="btn edit small" data-id="${st.stockId}">Edit</button>
        <button class="btn delete small" data-id="${st.stockId}">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
function renderSellRequests(){
  const ul = $('sell-requests'); ul.innerHTML='';
  sellRequests.forEach(r=>{
    const li = document.createElement('li');
    li.innerHTML = `
      <div style="flex:1">#${r.id} — <strong>${r.investor}</strong> wants to sell <strong>${r.shares}</strong> of ${r.stock} <div class="muted" style="font-size:12px">${r.reason}</div></div>
      <div style="display:flex;gap:8px">
        <button class="btn small" data-action="approve" data-id="${r.id}" style="background:#10b981;color:#022a22">Approve</button>
        <button class="btn small" data-action="reject" data-id="${r.id}" style="background:#f59e0b">Reject</button>
      </div>
    `;
    ul.appendChild(li);
  });
  $('pending-count').textContent = sellRequests.length;
}
function renderFraudAlerts(){
  const ul = $('fraud-alerts'); ul.innerHTML='';
  fraudAlerts.forEach(a=>{
    const li = document.createElement('li');
    li.innerHTML = `<div><strong class="fraud">${a.title}</strong> <div class="muted" style="font-size:13px">${a.desc} <span style="display:block;font-size:12px">${a.time}</span></div></div>`;
    ul.appendChild(li);
  });
  $('fraud-count').textContent = fraudAlerts.length;
  const fl = $('fraud-list'); fl.innerHTML='';
  fraudAlerts.forEach(a=>{ const item = document.createElement('li'); item.textContent = a.title + ' — ' + a.time; fl.appendChild(item); });
}

// ----- Event wiring -----
function setupNav(){
  function show(view){
    document.querySelectorAll('.view').forEach(v=>v.style.display='none');
    $('view-'+view).style.display='block';
    document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
    $('nav-'+view).classList.add('active');
  }
  $('nav-home').addEventListener('click',()=>show('home'));
  $('nav-transactions').addEventListener('click',()=>show('transactions'));
  $('nav-stocks').addEventListener('click',()=>show('stocks'));
}

// table action delegation
document.addEventListener('click',e=>{
  if(e.target.matches('#btn-add-tx')) return openTxModal();
  if(e.target.matches('#btn-add-stock')) return openStockModal();
  if(e.target.matches('#btn-refresh-tx')) return renderTxTable(document.querySelector('#tx-search').value);
  if(e.target.matches('#tx-table .edit')){
    const id = Number(e.target.dataset.id); openTxModal(id);
  }
  if(e.target.matches('#tx-table .delete')){
    const id = Number(e.target.dataset.id);
    if(confirm('Delete transaction #'+id+'?')){transactions = transactions.filter(t=>t.id!==id); renderTxTable(); updateCharts();}
  }
  if(e.target.matches('#stock-table .edit')){
    const id = e.target.dataset.id; openStockModal(id);
  }
  if(e.target.matches('#stock-table .delete')){
    const id = e.target.dataset.id;
    if(confirm('Delete stock '+id+'?')){stocks = stocks.filter(s=>s.stockId!==id); renderStockTable(); updateCharts();}
  }
  if(e.target.closest('#sell-requests') && e.target.dataset.action){
    const id = Number(e.target.dataset.id);
    const action = e.target.dataset.action;
    if(action==='approve'){
      sellRequests = sellRequests.filter(r=>r.id!==id);
      alert('Request #'+id+' approved.');
    } else { sellRequests = sellRequests.filter(r=>r.id!==id); alert('Request #'+id+' rejected.'); }
    renderSellRequests();
  }
});

// search inputs
$('tx-search').addEventListener('input',e=>renderTxTable(e.target.value));
$('stock-search').addEventListener('input',e=>renderStockTable(e.target.value));

// modal handling
const modalBack = $('modal-back');
const modalContent = $('modal-content');
const modalSave = $('modal-save');
const modalCancel = $('modal-cancel');
let modalMode = null; // {kind:'tx'|'stock', id:...}
function openTxModal(id=null){
  modalMode = {kind:'tx',id};
  const tx = id ? transactions.find(t=>t.id===id) : {id:Date.now(),ts:new Date().toISOString().slice(0,16).replace('T',' '),type:'Buy',company:'',investor:'',shares:0,price:0};
  modalContent.innerHTML = `
    <h3>${id ? 'Edit' : 'Add'} Transaction</h3>
    <div style="margin-top:8px">
      <label>Type <select id="m-type"><option>Buy</option><option>Sell</option></select></label>
      <div class="row" style="margin-top:8px"><input id="m-company" placeholder="Company" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${tx.company}" /><input id="m-investor" placeholder="Investor" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${tx.investor}" /></div>
      <div class="row" style="margin-top:8px"><input id="m-shares" type="number" placeholder="Shares" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${tx.shares}" /><input id="m-price" type="number" step="0.01" placeholder="Price" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${tx.price}" /></div>
    </div>
  `;
  $('m-type').value = tx.type;
  modalBack.style.display='flex';
}
function openStockModal(id=null){
  modalMode = {kind:'stock',id};
  const st = id ? stocks.find(s=>s.stockId===id) : {stockId:'STK-'+Math.floor(Math.random()*900+100),companyId:'',shares:0,price:0};
  modalContent.innerHTML = `
    <h3>${id ? 'Edit' : 'Add'} Stock</h3>
    <div style="margin-top:8px">
      <div class="row"><input id="m-stockId" placeholder="Stock ID" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${st.stockId}" ${id? 'disabled':''} /><input id="m-companyId" placeholder="Company ID" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${st.companyId}" /></div>
      <div class="row" style="margin-top:8px"><input id="m-shares" type="number" placeholder="Total Shares" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${st.shares}" /><input id="m-price" type="number" step="0.01" placeholder="Current Price" style="flex:1;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)" value="${st.price}" /></div>
    </div>
  `;
  modalBack.style.display='flex';
}
modalCancel.addEventListener('click',()=>{modalBack.style.display='none'});
modalSave.addEventListener('click',()=>{
  if(!modalMode) return; const kind = modalMode.kind;
  if(kind==='tx'){
    const id = modalMode.id || Number(document.querySelector('#m-id')?.value || Date.now());
    const record = {id:id,ts:new Date().toISOString().slice(0,16).replace('T',' '),type:$('m-type').value,company:$('m-company').value,investor:$('m-investor').value,shares:Number($('m-shares').value),price:Number($('m-price').value)};
    if(modalMode.id){ transactions = transactions.map(t=>t.id===modalMode.id?record:t); }
    else { transactions.push(record); }
    renderTxTable(); updateCharts();
  } else if(kind==='stock'){
    const sid = $('m-stockId').value; const rec = {stockId:sid,companyId:$('m-companyId').value,shares:Number($('m-shares').value),price:Number($('m-price').value)};
    if(modalMode.id){ stocks = stocks.map(s=>s.stockId===modalMode.id?rec:s); }
    else { stocks.push(rec); }
    renderStockTable(); updateCharts();
  }
  modalBack.style.display='none';
});

// init
setupNav();
  renderTxTable();
  renderStockTable();
  renderSellRequests();
  renderFraudAlerts();

  // Logout behavior: show a dedicated "You have been logged out" page
  $('logout').addEventListener('click', ()=>{
    // hide other views
    document.querySelectorAll('.view').forEach(v=>v.style.display='none');

    // create logout view if not exists
    if(!document.getElementById('view-logout')){
      const logoutSection = document.createElement('section');
      logoutSection.id = 'view-logout';
      logoutSection.className = 'view';
      logoutSection.style.marginTop = '18px';
      logoutSection.innerHTML = `
        <div class="card">
          <h2>Logged out</h2>
          <p>You have been logged out.</p>
          <p class="muted">For demo purposes this is a client-side logout page — no server session is destroyed here.</p>
          <div style="margin-top:12px">
            <button id="btn-login-again" class="btn">Login Again</button>
          </div>
        </div>
      `;
      document.querySelector('.container').appendChild(logoutSection);

      // wire the "Login Again" button to return to Home
      document.getElementById('btn-login-again').addEventListener('click', ()=>{
        document.querySelectorAll('.view').forEach(v=>v.style.display='none');
        $('view-home').style.display = 'block';
        document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
        $('nav-home').classList.add('active');
        // remove the logout view from DOM
        const node = document.getElementById('view-logout');
        if(node) node.remove();
      });
    }

    // show the logout view
    document.getElementById('view-logout').style.display = 'block';
  });

// Charts
let txChart=null, stocksChart=null;
function updateCharts(){
  // transactions per day (last 7 days sample)
  const labels = [];
  const dataCounts = [];
  for(let i=6;i>=0;i--){ const d = new Date(); d.setDate(d.getDate()-i); const lbl = d.toLocaleDateString(); labels.push(lbl); const cnt = transactions.filter(t=>t.ts.startsWith(d.toISOString().slice(0,10))).length; dataCounts.push(cnt); }
  if(txChart) txChart.data.labels = labels, txChart.data.datasets[0].data = dataCounts, txChart.update(); else txChart = new Chart(document.getElementById('txChart').getContext('2d'),{type:'bar',data:{labels:labels,datasets:[{label:'Transactions',data:dataCounts,backgroundColor:'rgba(79,70,229,0.6)'}]},options:{responsive:true,plugins:{legend:{display:false}}}});

  // top stocks by market cap
  const sLabels = stocks.map(s=>s.companyId);
  const sData = stocks.map(s=>s.shares * s.price);
  if(stocksChart) stocksChart.data.labels = sLabels, stocksChart.data.datasets[0].data = sData, stocksChart.update(); else stocksChart = new Chart(document.getElementById('stocksChart').getContext('2d'),{type:'pie',data:{labels:sLabels,datasets:[{label:'Market Cap',data:sData}]},options:{responsive:true}});
}
updateCharts();

// small helpers to simulate adding a fraud alert (for demo)
setTimeout(()=>{ fraudAlerts.push({id:2,title:'Multiple failed login attempts',desc:'Multiple failed trader logins detected',time:new Date().toISOString().slice(0,16).replace('T',' ')}); renderFraudAlerts(); },2000);

</script>
</body>
</html>
